<!DOCTYPE html>
<html>
    <head>
        <title>Activity Stream Publisher</title>
        <link href="css/main.css" rel="stylesheet" type="text/css">
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
    </head>
    <body>
        <section id="main">
            <h1>Activity Stream Publisher</h1>
            <p><a href="#docs">What is this all about?</a></p>

            <div id="post-app">

                <form id="login" class="login pre-login">
                    <fieldset class="user">
                        <legend>Login</legend>
                        <ul>
                            <li><label>Bucket</label>
                                <input type="text" name="bucket" required="required"
                                    placeholder="Bucket" />
                            </li>
                            <li><label>Username</label>
                                <input type="text" name="username" required="required" 
                                    placeholder="Username" />
                            </li>
                            <li><label>Password</label>
                                <input type="password" name="password" required="required"
                                    placeholder="Password" />
                            </li>
                            <li class="remember">
                                <label for="id_remember">Stay logged in?</label>
                                <input type="checkbox" id="id_remember" name="remember" />
                            </li>
                        </ul>
                    </fieldset>
                    <fieldset class="buttons">
                        <button class="login"><span>Login</span></button>
                    </fieldset>
                </form>

                <form id="register" class="register pre-login">
                    <fieldset class="user">
                        <legend>Register</legend>
                        <ul>
                            <li><label>Bucket</label>
                                <input type="text" name="bucket" required="required" 
                                    placeholder="Bucket"/></li>
                            <li><label>Username</label>
                                <input type="text" name="username" required="required" 
                                    placeholder="Username" /></li>
                            <li><label>Password</label>
                                <input type="password" name="password" required="required" 
                                    placeholder="Password" /></li>
                            <li><label>Password (again)</label>
                                <input type="password" name="password_confirm" 
                                    required="required" data-confirm="password" 
                                    placeholder="Password (again)" /></li>
                            <li><label>Key ID</label>
                                <input type="text" name="key_id" required="required" 
                                    placeholder="Key ID" /></li>
                            <li><label>Secret Key</label>
                                <input type="text" name="secret_key" required="required" 
                                    placeholder="Secret Key" /></li>
                        </ul>
                    </fieldset>
                    <fieldset class="prefs">
                        <legend>Prefs</legend>
                        <ul>
                            <li><label>Name</label>
                                <input type="text" name="displayName" required="required" 
                                    placeholder="Display Name" /></li>
                            <li><label>Email</label>
                                <input type="text" name="email" required="required" 
                                    placeholder="Email" /></li>
                            <li><label>URL</label>
                                <input type="text" name="url" 
                                    placeholder="URL" /></li>
                            <li><label>Bio</label>
                                <textarea name="summary" cols="50" rows="7" 
                                    placeholder="Bio"></textarea></li>
                        </ul>
                    </fieldset>
                    <fieldset class="buttons">
                        <button class="register"><span>Register</span></button>
                    </fieldset>
                </form>

                <form class="user needs-login">
                    <fieldset>
                        <button class="logout">Logout</button>
                        <button class="editPrefs">Edit Prefs</button>
                        <button class="destroyPrefs">Destroy Account</button>
                    </fieldset>
                    <ul class="urls">
                        <li><a class="url_html" href="" data-url="index.html">HTML</a></li>
                        <li><a class="url_rss" href="" data-url="feeds/activities.rss">RSS</a></li>
                        <li><a class="url_json" href="" data-url="feeds/activities.json">JSON</a></li>
                    </ul>
                </form>

                <form class="prefs needs-login hidden">
                    <fieldset>
                        <legend>Prefs</legend>
                        <ul>
                            <li><label>Name</label>
                                <input type="text" name="displayName" required="required" /></li>
                            <li><label>Email</label>
                                <input type="text" name="email" required="required" /></li>
                            <li><label>URL</label>
                                <input type="text" name="url" /></li>
                            <li><label>Bio</label>
                                <textarea name="summary" cols="50" rows="7"></textarea></li>
                        </ul>
                    </fieldset>
                    <fieldset class="buttons">
                        <button class="save">Save</button>
                        <button class="cancel">Cancel</button>
                    </fieldset>
                </form>

                <form class="activity needs-login">

                    <fieldset class="verb">
                        <legend>Verb</legend>
                        <ul>
                            <li id="f_verb">
                                <label>Verb</label>
                                <select id="verb">
                                    <option value="post">post</option>
                                </select>
                            </li>
                        </ul>
                    </fieldset>

                    <fieldset class="object">
                        <legend>Object</legend>
                        <ul>
                            <li id="f_object_type">
                                <label>Type</label>
                                <select id="object_type">
                                    <option value="note">note</option>
                                </select>
                            </li>
                            <li id="f_object_displayName">
                                <label>Name</label>
                                <input type="text" id="object_displayName" />
                            </li>
                            <li id="f_object_content">
                                <label>Content</label>
                                <textarea id="object_content" cols="50" rows="7"></textarea>
                            </li>
                        </ul>
                    </fieldset>

                    <fieldset class="buttons">
                        <legend>Buttons</legend>
                        <button class="post">Post</button>
                        <button class="reset">Reset</button>
                    </fieldset>

                </form>

                <section class="activities needs-login">
                    <ul class="stream">
                    </ul>
                </section>

                <ul class="templates hidden">
                    <li id="activity-template" class="activity">
                        <span class="published"></span>
                        <img class="image" src="" width="" height="" />
                        <div class="object">
                            <a class="displayName" href="">name</a>
                            <p class="content"></p>
                        </div>
                        <span class="buttons">
                            <button class="delete">Delete</button>
                            <button class="edit">Edit</button>
                        </span>
                    </li>
                </ul>

            </div>

            <section id="docs" class="docs"><script type="markdown">
                ## What is this?

                This is an experiment in using Activity Streams, and in
                building Open Web atop Amazon S3. More specifically, this
                is a tool for publishing a personal microblog or activity
                stream from a modern browser to an S3 bucket.

                ## Why is this interesting?

                This app requires just a modern browser and Amazon S3 to
                publish an activity stream on the web, from just about any
                device with a modern browser.

                Through the magic of REST, AJAX, cryptography, and an
                additional buzzword bingo assemblage of Open Web
                technologies, you need neither set up a server nor install
                any software on your computer.

                ## How do I use it?

                I want to write a more complete guide to this thing when it
                matures, but here's the skinny:
                
                * [Sign up for AWS][signup], if you haven't already.
                
                * [Create a bucket in S3][s3], remember what you named it.

                    * Bonus points: If you name the bucket after a domain name
                        you control (eg. [`stream.lmorchard.com`][stream] is mine),
                        you can [set up a CNAME with your DNS provider][s3website]
                        to customize the URL to your activity stream.

                * [Get your Access Keys][accesskeys] (ie. Key ID and Secret
                    Access Key)
                    
                    * Bonus points: For safer usage, [use IAM to create a
                        new user][iam] that has only S3 read/write access to
                        the bucket you just created, and use the set of Access
                        Keys for that user
                        
                * [Register with this app][register], using your
                    earlier-created bucket, a new username and password, and
                    your AWS Access Credentials. Also, fill out the
                    biographical profile details.

                * [Login with your username and password][login] on a
                    modern desktop or mobile browser, post activities and
                    behold the publishing magic.

                ## Wait, what? Is this secure?

                The short answer is: I don't know. Maybe not. You tell me!
                Why register? And what happens to your valuable and
                sensitive AWS credentials?  Those credentials—and your
                biographical details—are really too long to remember and
                cumbersome to type on a mobile device. But, this app still
                needs them. A username and password are a bit more friendly
                and memorable.

                I'm trying to make a compromise between usability and
                protecting your Access Credentials—but I may be mistaken and
                might have instead compromised the keys to your AWS account. 
                You decide:

                When you "register", the data your submit is encrypted with
                your password, using [AES][].  That encrypted bundle is
                then stored on S3 with an URL based on a SHA1 hash of your
                username.  That resource is world-readable.

                Later, when you "login", the encrypted bundle is fetched
                via your username and your password is used to decrypt it.
                This supplies the app with your AWS Credentials, along with
                all the biographical profile information you supplied.

                (I stole this idea from [Jacob Wright][jacwright], by the
                way.) 

                If you're paranoid (and you should be), this is why I
                mentioned [using IAM to create a new user][iam] earlier.
                This is an experiment, and though I promise I'm not going
                to do anything malicious, you might not want to trust that
                I know what I'm doing.  If you create a limited-permission
                set of credentials, the damage can be minimized in case I'm
                totally mistaken about what I'm doing here.

                ## Where is the source?

                This is part of a larger project, which is an attempt at
                writing my next book.

                [Fork me on GitHub][source]
            
                [signup]: http://aws.amazon.com/
                [s3]: https://console.aws.amazon.com/s3/home
                [iam]: https://console.aws.amazon.com/iam/home
                [s3website]: http://aws.typepad.com/aws/2011/02/host-your-static-website-on-amazon-s3.html
                [stream]: http://stream.lmorchard.com
                [accesskeys]: https://aws-portal.amazon.com/gp/aws/developer/account/index.html?action=access-key#access_credentials
                [register]: #register
                [login]: #login
                [jacwright]: http://jacwright.com/556/client-side-only-javascript-amazon-s3-cms/
                [aes]: https://github.com/mdp/gibberish-aes
                [source]: https://github.com/lmorchard/tinkering-with-activity-streams/tree/master/code/web
            </script></section>

        </section>

        <script src="js/jquery.js" type="text/javascript"></script>
        <script src="js/showdown.js" type="text/javascript"></script>
        <script src="js/async.js" type="text/javascript"></script>
        <script src="js/underscore.js" type="text/javascript"></script>
        <script src="js/backbone.js" type="text/javascript"></script>
        <script src="js/gibberish-aes.js" type="text/javascript"></script>
        <script src="js/md5.js" type="text/javascript"></script>
        <script src="js/sha1.js" type="text/javascript"></script>
        <script src="js/S3Ajax.js" type="text/javascript"></script>

        <script src="js/twas/s3sync.js" type="text/javascript"></script>

        <script src="js/twas/prefs.js" type="text/javascript"></script>
        <script src="js/twas/models.js" type="text/javascript"></script>
        <script src="js/twas/views.js" type="text/javascript"></script>
        <script src="js/twas/feeds.js" type="text/javascript"></script>
        <script src="js/twas/main.js" type="text/javascript"></script>

    </body>
</html>

